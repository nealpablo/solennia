<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/src/style.css" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solennia — My Profile</title>
  <meta name="theme-color" content="#e8ddae" />
  <style>
    .ring-outer { box-shadow: 0 0 0 3px #e8ddae inset, 0 0 0 4px #353946 inset; }
    html { min-height: 100%; }
    body { min-height: 100vh; display: flex; flex-direction: column; overflow-y: auto; overflow-x: hidden; }
    main { flex: 1 0 auto; }
    .panel { background:#ece8e1; border:1px solid #d9d6cf; border-radius:12px; }
    .kcard { background:#efebe4; border:1px solid #ddd6c8; border-radius:14px; }
    .btn-brown { background:#7a5d47; color:#fff; border-radius:8px; padding:.55rem 1rem; }
    .btn-brown:hover { opacity:.9; }
    .btn-ghost { background:#e0d6c6; color:#3b2f25; border-radius:8px; padding:.55rem 1rem; }
    .shadow-soft { box-shadow: 0 4px 14px rgba(0,0,0,.06); }
    .badge-sep::after { content:" / "; margin: 0 .65rem; color:#6b6b6b; }
    .icon-btn { width:34px; height:34px; display:flex; align-items:center; justify-content:center; border-radius:9999px; border:1px solid #bfbfbf; background:#fff; }
    .avatar { width:7.5rem; height:7.5rem; border-radius:9999px; border:2px solid #1c1b1a; display:flex; align-items:center; justify-content:center; background:#fff; overflow:hidden; }
    .fav-img{ width:100%; height:170px; object-fit:cover; display:block; }
    @media (min-width:768px){ .fav-img{ height:220px; } }
    #profileBtn { border-width:2px !important; border-color:#000 !important; background:transparent !important; border-radius:9999px !important; }
  </style>
</head>
<body class="font-[Cinzel] text-[#1c1b1a] bg-[#f6f0e8]">
  <div data-include="/partials/header.html"></div>

  <input id="avatarFile" type="file" accept="image/*" class="hidden" />

  <!-- ✅ Added bottom padding so content doesn’t stick to footer -->
  <main class="pb-24">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="mt-6 text-xl md:text-2xl font-semibold tracking-wide">PROFILE</h2>

      <div class="flex flex-col items-center text-center space-y-4">
        <div id="avatarContainer" style="cursor:pointer; position:relative; width:112px; height:112px; border:2px solid #000; border-radius:9999px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:transparent;">
          <img id="profileAvatar" alt="Avatar" style="width:100%; height:100%; object-fit:cover; display:none;" />
          <svg id="profileAvatarFallback" viewBox="0 0 24 24" aria-hidden="true" style="width:48px; height:48px; color:#1c1b1a; fill:currentColor;">
            <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-9 2.5-9 5.5V21h18v-1.5C21 16.5 17 14 12 14Z" />
          </svg>
        </div>

        <div class="text-sm">
          <span class="font-semibold uppercase tracking-wide">Name :</span>
          <span id="profileName" class="ml-1">Guest</span>
        </div>

        <a href="#" class="btn-ghost inline-block">View Dashboard</a>
      </div>

      <h2 class="mt-10 text-xl md:text-2xl font-semibold tracking-wide">FAVORITES</h2>

      <section class="mt-3 panel shadow-soft p-4 md:p-6">
        <article class="rounded-xl border border-[#ded7c9] overflow-hidden bg-[#f5f0ea] mb-4">
          <img src="/images/gallery1.jpg" alt="Lagen Island Chapel, El Nido" class="fav-img">
          <div class="p-3">
            <h4 class="text-[13px] font-semibold leading-tight uppercase">Lagen Island Chapel, El Nido</h4>
            <p class="text-[11px] text-gray-700 mt-1">90 kilometers away</p>
            <div class="mt-2 flex items-center gap-3">
              <svg class="w-5 h-5 fav-heart cursor-pointer transition-colors" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-label="Like"><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 1 0-7.8 7.8l1 1L12 22l7.8-8.6 1-1a5.5 5.5 0 0 0 0-7.8z" /></svg>
              <svg class="w-5 h-5 fav-star cursor-pointer transition-colors" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-label="Favorite"><path d="m12 17.27 6.18 3.73-1.64-7.03L21 9.24l-7.19-.61L12 2 10.19 8.63 3 9.24l4.46 4.73L5.82 21z" /></svg>
            </div>
          </div>
        </article>

        <article class="rounded-xl border border-[#ded7c9] overflow-hidden bg-[#f5f0ea]">
          <img src="/images/gallery2.jpg" alt="Shangri-La Mactan, Cebu" class="fav-img">
          <div class="p-3">
            <h4 class="text-[13px] font-semibold leading-tight uppercase">Shangri-La Mactan, Cebu</h4>
            <p class="text-[11px] text-gray-700 mt-1">90 kilometers away</p>
            <div class="mt-2 flex items-center gap-3">
              <svg class="w-5 h-5 fav-heart cursor-pointer transition-colors" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-label="Like"><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 1 0-7.8 7.8l1 1L12 22l7.8-8.6 1-1a5.5 5.5 0 0 0 0-7.8z" /></svg>
              <svg class="w-5 h-5 fav-star cursor-pointer transition-colors" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-label="Favorite"><path d="m12 17.27 6.18 3.73-1.64-7.03L21 9.24l-7.19-.61L12 2 10.19 8.63 3 9.24l4.46 4.73L5.82 21z" /></svg>
            </div>
          </div>
        </article>

        <div class="mt-6 flex justify-center">
          <button class="btn-brown">Compare Favorites</button>
        </div>
      </section>

      <!-- ✅ Added spacing before footer -->
      <section class="mt-10 text-center mb-16">
        <h3 class="text-xl font-semibold tracking-wide">POST YOUR SERVICES</h3>
        <div class="mt-4">
          <button id="joinVendorBtn" class="btn-brown">Join as a Vendor</button>
        </div>
      </section>
    </div>
  </main>

  <div data-include="/partials/footer.html"></div>
  <div data-include="/partials/modals.html"></div>

  <script type="module" src="/src/partials-loader.js"></script>

  <!-- Cached name fetch (kept) -->
  <script>
    (function () {
      const nameEl = document.getElementById('profileName');
      if (!nameEl) return;
      function setName(first, last) { const full = [first, last].filter(Boolean).join(' '); nameEl.textContent = full || 'User'; }
      try {
        const cached = localStorage.getItem('solennia_profile');
        if (cached) { const u = JSON.parse(cached); if (u && (u.first_name || u.last_name)) { setName(u.first_name || '', u.last_name || ''); return; } }
      } catch {}
      const token = localStorage.getItem('solennia_token'); if (!token) return;
      const endpoints = ['/api/auth/me', '/api/me', '/api/profile', '/api/users/me'];
      (async () => {
        for (const url of endpoints) {
          try {
            const res = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
            if (!res.ok) continue;
            const data = await res.json().catch(() => null);
            if (!data) continue;
            const first = data.first_name || data.firstName || data.given_name || '';
            const last  = data.last_name  || data.lastName  || data.family_name || '';
            if (first || last) { localStorage.setItem('solennia_profile', JSON.stringify({ first_name:first, last_name:last })); setName(first, last); break; }
          } catch {}
        }
      })();
    })();
  </script>

  <!-- Avatar upload & persistence (kept) -->
  <script>
    (function () {
      const LS_KEY = 'solennia_avatar_dataurl';
      const TOKEN_KEY = 'solennia_token';
      const avatarContainer = document.getElementById('avatarContainer');
      let fileInput = document.getElementById('avatarFile');
      if (!fileInput) { fileInput = document.createElement('input'); fileInput.type='file'; fileInput.accept='image/*'; fileInput.id='avatarFile'; fileInput.style.display='none'; document.body.appendChild(fileInput); }
      const profileImg = document.getElementById('profileAvatar');
      const fallback = document.getElementById('profileAvatarFallback');
      const navImg = document.getElementById('navAvatar');
      const navFallback = document.getElementById('navAvatarFallback');
      const logoutBtn = document.getElementById('menuLogout');

      const isLoggedIn = () => !!localStorage.getItem(TOKEN_KEY);
      function applyAvatar(dataUrl) {
        if (dataUrl) {
          profileImg.src = dataUrl; profileImg.style.display = 'block'; fallback.style.display = 'none';
          if (navImg) { navImg.src = dataUrl; navImg.classList.remove('hidden'); navFallback.classList.add('hidden'); }
        } else {
          profileImg.style.display = 'none'; fallback.style.display = 'block';
          if (navImg) { navImg.classList.add('hidden'); navFallback.classList.remove('hidden'); }
        }
      }
      if (isLoggedIn()) { const saved = localStorage.getItem(LS_KEY); if (saved) applyAvatar(saved); } else { applyAvatar(null); }
      avatarContainer?.addEventListener('click', () => fileInput?.click());
      fileInput?.addEventListener('change', async () => {
        const file = fileInput.files?.[0]; if (!file) return;
        if (!file.type.startsWith('image/')) { alert('Please upload a valid image file.'); return; }
        if (file.size > 500 * 1024) { alert('Please upload an image smaller than 500KB.'); return; }
        const img = new Image(); const objectURL = URL.createObjectURL(file); img.src = objectURL;
        img.onload = () => {
          const { width, height } = img; URL.revokeObjectURL(objectURL);
          if (Math.abs(width - height) > 5) { alert('Please upload a square image.'); return; }
          if (width < 300 || height < 300) { alert('Please upload at least 300x300.'); return; }
          const reader = new FileReader();
          reader.onload = () => {
            const dataUrl = reader.result; applyAvatar(dataUrl);
            if (isLoggedIn()) localStorage.setItem(LS_KEY, dataUrl); else alert("You're not logged in — this avatar will reset after refresh.");
          };
          reader.readAsDataURL(file);
        };
      });
      logoutBtn?.addEventListener('click', () => { localStorage.removeItem(LS_KEY); applyAvatar(null); });
    })();
  </script>

  <!-- Heart & star toggles (kept) -->
  <script>
    document.querySelectorAll('.fav-heart').forEach((svg) => {
      svg.addEventListener('click', () => {
        const active = svg.getAttribute('data-active') === '1';
        if (active) { svg.setAttribute('data-active','0'); svg.setAttribute('fill','none'); svg.setAttribute('stroke','currentColor'); svg.classList.remove('text-red-600'); }
        else { svg.setAttribute('data-active','1'); svg.setAttribute('fill','currentColor'); svg.setAttribute('stroke','none'); svg.classList.add('text-red-600'); }
      });
    });
    document.querySelectorAll('.fav-star').forEach((svg) => {
      svg.addEventListener('click', () => {
        const active = svg.getAttribute('data-active') === '1';
        if (active) { svg.setAttribute('data-active','0'); svg.setAttribute('fill','none'); svg.setAttribute('stroke','currentColor'); svg.classList.remove('text-yellow-400'); }
        else { svg.setAttribute('data-active','1'); svg.setAttribute('fill','currentColor'); svg.setAttribute('stroke','none'); svg.classList.add('text-yellow-400'); }
      });
    });
  </script>
</body>
</html>
